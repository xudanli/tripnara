# 数据库表清单

## 1. 用户与账号
| 表名 | 说明 |
|------|------|
| `users` | 基础账号字段（邮箱/手机号、昵称、头像、语言偏好、状态等） |
| `user_profiles` | 旅客画像补充信息（国籍、常住地、偏好标签、个性画像） |
| `user_auth_providers` | 第三方登录绑定记录 |
| `user_settings` | 功能开关、通知设置、实验开关等 |

---

## 2. 行程模板
| 表名 | 说明 |
|------|------|
| `journey_templates` | 模板主表（名称、封面、核心洞察、默认安全提示、背景等 JSON） |
| `template_days` | 模板的每日结构（day_number、title、summary、details_json） |
| `template_time_slots` | 模板内的具体时段活动（type、title、start_time、details_json 等） |
| `template_tasks` *(可选)* | 模板级准备任务默认值（如额外区分存储） |

---

## 3. 行程实例（用户生成）
| 表名 | 说明 |
|------|------|
| `journeys` | 行程主表（关联 user_id/template_id、核心洞察、旅程设计、任务 JSON 等） |
| `journey_days` | 行程每天信息（date、主题、details_json 等） |
| `journey_time_slots` | 活动时段（类型、summary、transport、媒体信息、来源） |
| `journey_tasks` *(如需要拆表)* | 若任务希望结构化存储，可单独抽表 |

---

## 4. AI 调用与生成
| 表名 | 说明 |
|------|------|
| `ai_request_logs` | 每次 LLM/AI 调用的记录（module、prompt、response、token 用量） |
| `ai_generation_jobs` | 行程生成的任务链状态（队列、步骤、耗时、错误信息） |
| `ai_safety_notice_cache` | 安全提示缓存（key = 目的地+语言+摘要 hash，文本、语言、时间） |

---

## 5. 外部数据与地理信息
| 表名 | 说明 |
|------|------|
| `destinations` | 目的地/城市/地标信息（Geo、国家代码、别名） |
| `countries` | 国家列表与签证/货币/高风险信息 |
| `transport_modes` | 标准化交通方式（与前端 `transportModes.ts` 同步） |
| `high_altitude_regions` | 高海拔地区数据 |
| `preparation_profiles` | 不同主题/目的地的行前任务模板 |
| `media_assets` | 行程活动图片/视频的 CDN 地址、版权元数据 |
| `external_api_keys` | 外部服务鉴权配置（仅后端存放，限制访问） |

---

## 6. 用户行为与日志
| 表名 | 说明 |
|------|------|
| `journey_edits` | 记录行程编辑历史（变更类型、原值/新值、操作者） |
| `journey_versions` *(可选)* | 行程历史版本快照 |
| `journey_feedback` | 用户对行程/生成结果的反馈与评分 |
| `journey_shares` | 分享记录（生成链接、访问次数等） |
| `journey_collaborators` | 协同编辑成员 |
| `notifications` | 站内通知（安全提醒、生成完成等） |

---

## 7. 统计与推荐 *(可选)*
| 表名 | 说明 |
|------|------|
| `analytics_daily` | 运营指标（生成次数、活跃行程、AI 成本） |
| `recommendation_logs` | 推荐算法展示/点击数据 |
| `user_template_usage` | 模板被用户使用次数与行为统计 |

---

> 以上表结构可配合 JSON 字段保存灵活数据，并支持后期按模块拆分子服务。如果需要具体字段/DDL，可基于此清单进一步细化。
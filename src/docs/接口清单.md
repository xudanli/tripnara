# 系统接口清单（REST v1）

## 0. 认证
- `POST /api/v1/auth/login`：账号登录（邮箱/手机号 + 密码或验证码）
- `POST /api/v1/auth/logout`
- `POST /api/v1/auth/refresh`
- `POST /api/v1/auth/providers/:provider/callback`：微信/Apple/Google 回调
- `GET  /api/v1/auth/profile`：获取当前登录用户信息

---

## 1. 模板管理（Template）
- `GET    /api/v1/templates`：查询模板列表（筛选：主题、天数、状态）
- `GET    /api/v1/templates/:templateId`：模板详情 + days/timeSlots
- `POST   /api/v1/templates`：创建模板
- `PATCH  /api/v1/templates/:templateId`：更新模板元信息/结构
- `DELETE /api/v1/templates/:templateId`：删除/归档模板
- `POST   /api/v1/templates/:templateId/publish`：发布模板
- `POST   /api/v1/templates/:templateId/clone`：复制模板
- `GET    /api/v1/templates/:templateId/days`
- `POST   /api/v1/templates/:templateId/days`
- `PATCH  /api/v1/templates/:templateId/days/:dayId`
- `DELETE /api/v1/templates/:templateId/days/:dayId`
- `GET    /api/v1/templates/:templateId/days/:dayId/slots`
- `POST   /api/v1/templates/:templateId/days/:dayId/slots`
- `PATCH  /api/v1/templates/:templateId/days/:dayId/slots/:slotId`
- `DELETE /api/v1/templates/:templateId/days/:dayId/slots/:slotId`

---

## 2. 行程（Journey）
- `GET    /api/v1/journeys`：用户行程列表
- `POST   /api/v1/journeys`：创建行程（可带 `templateId`、用户偏好、AI 生成参数）
- `GET    /api/v1/journeys/:journeyId`：行程详情
- `PATCH  /api/v1/journeys/:journeyId`：更新行程元信息
- `DELETE /api/v1/journeys/:journeyId`
- `POST   /api/v1/journeys/:journeyId/clone`
- `POST   /api/v1/journeys/:journeyId/share`
- `GET    /api/v1/journeys/:journeyId/export`（PDF/ICS 等）
- `POST   /api/v1/journeys/:journeyId/reset`：重置为初始状态（保留历史版本）
- `GET    /api/v1/journeys/:journeyId/days`
- `POST   /api/v1/journeys/:journeyId/days`
- `PATCH  /api/v1/journeys/:journeyId/days/:dayId`
- `DELETE /api/v1/journeys/:journeyId/days/:dayId`
- `GET    /api/v1/journeys/:journeyId/days/:dayId/slots`
- `POST   /api/v1/journeys/:journeyId/days/:dayId/slots`
- `PATCH  /api/v1/journeys/:journeyId/days/:dayId/slots/:slotId`
- `DELETE /api/v1/journeys/:journeyId/days/:dayId/slots/:slotId`
- `POST   /api/v1/journeys/:journeyId/days/:dayId/slots/reorder`

---

## 3. 行程生成与 AI
- `POST /api/v1/journeys/:journeyId/generate`：启动完整生成流程
  - body 可指定需要的阶段：`["framework","dayDetails","transport","tips","scenicIntro","safetyNotice"]`
- `GET  /api/v1/journeys/:journeyId/generate/status`：查看生成进度
- `POST /api/v1/journeys/:journeyId/generate/framework`
- `POST /api/v1/journeys/:journeyId/generate/day-details`
- `POST /api/v1/journeys/:journeyId/generate/transport`
- `POST /api/v1/journeys/:journeyId/generate/scenic-intro`
- `POST /api/v1/journeys/:journeyId/generate/tips`
- `POST /api/v1/journeys/:journeyId/generate/safety-notice`
- `GET  /api/v1/journeys/:journeyId/ai/logs`：查询 AI 调用日志
- `GET  /api/v1/ai/safety-notice/cache`：缓存命中情况（仅限后台）
- `DELETE /api/v1/ai/safety-notice/cache/:key`：清除缓存项

---

## 4. 准备任务 & Checklist
- `GET    /api/v1/journeys/:journeyId/tasks`：查看行程准备任务
- `POST   /api/v1/journeys/:journeyId/tasks/sync`：根据目的地/模板重新生成并合并
- `PATCH  /api/v1/journeys/:journeyId/tasks/:taskId`：修改任务（完成状态、自定义标题、链接）
- `DELETE /api/v1/journeys/:journeyId/tasks/:taskId`
- `POST   /api/v1/journeys/:journeyId/tasks`：新增自定义任务
- `GET    /api/v1/preparation-profiles`：后台维护任务模板
- `POST   /api/v1/preparation-profiles`（仅管理员）

---

## 5. 安全提示 & 旅行提醒
- `POST /api/v1/journeys/:journeyId/safety-notice`：生成/刷新安全提示（调用 AI + 缓存）
- `GET  /api/v1/journeys/:journeyId/safety-notice`：当前提示内容
- `GET  /api/v1/alerts`：通用旅行安全通知（按目的地/时间段）
- `POST /api/v1/alerts`（后台）

---

## 6. 外部数据聚合
- `GET /api/v1/destinations/search?query=`：地点模糊匹配 + Geo 数据
- `GET /api/v1/destinations/:id/details`：目的地详情（经纬度、签证政策摘要等）
- `GET /api/v1/destinations/:id/events`：活动信息（Eventbrite 等）
- `GET /api/v1/destinations/:id/weather`（可选）
- `POST /api/v1/transport/insights`：交通规划（origin/destination/mode）
- `POST /api/v1/poi/search`：POI 搜索（前端 `ExperienceDay` 复用）

---

## 7. 图片与媒体
- `POST /api/v1/media/search-image`：根据地点/关键词获取图片（代理 Unsplash/Pexels）
- `POST /api/v1/media/search-video`
- `POST /api/v1/media/upload`（如支持用户上传）
- `GET  /api/v1/media/:mediaId`：获取媒体元信息/签名 URL

---

## 8. 日志、版本与协作
- `GET  /api/v1/journeys/:journeyId/history`：版本/操作日志
- `POST /api/v1/journeys/:journeyId/revert/:versionId`
- `POST /api/v1/journeys/:journeyId/collaborators`：添加编辑者
- `DELETE /api/v1/journeys/:journeyId/collaborators/:userId`
- `GET  /api/v1/journeys/:journeyId/notifications`

---

## 9. 用户行为与推荐（可选）
- `POST /api/v1/journeys/:journeyId/feedback`：对生成结果打分/评论
- `GET  /api/v1/journeys/recommendations`：推荐模板或行程
- `GET  /api/v1/analytics/dashboard`（后台：AI 调用、热门目的地等）

---

## 10. 系统管理（Admin）
- `GET /api/v1/admin/ai/logs`：筛选 AI 调用
- `GET /api/v1/admin/templates`：管理所有模板
- `GET /api/v1/admin/journeys`：查看所有行程（运营/客服）
- `POST /api/v1/admin/preparation-profiles`、`DELETE` 等
- `GET /api/v1/admin/external-keys`（仅超级管理员）

---

> 若采用 GraphQL，可将上述 REST endpoint 转为 Query/Mutation；若采用微服务，可拆分 `TemplateService`、`JourneyService`、`AIService` 等独立接口。此清单覆盖当前系统功能（模板、行程、AI 生成、安全提示、任务、外部数据、媒体、协作与日志）。
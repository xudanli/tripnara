# 行程接口文档 - 19. 修改任务

## 接口信息

**接口路径：** `PATCH /api/v1/journeys/{journeyId}/tasks/{taskId}`

**接口描述：** 修改任务的完成状态、标题、链接等信息

**认证：** 需要 JWT Token（Bearer Token）

**Content-Type：** `application/json`

---

## 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `journeyId` | string | 是 | 行程ID（UUID） |
| `taskId` | string | 是 | 任务ID |

---

## 请求参数

### 请求体结构

所有字段都是可选的，只传入需要更新的字段即可。

```json
{
  "title": "更新后的任务标题",
  "completed": true,
  "links": [
    {
      "label": "新链接",
      "url": "https://example.com"
    }
  ]
}
```

### 字段说明

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `title` | string | 否 | 任务标题 |
| `completed` | boolean | 否 | 是否完成 |
| `links` | array | 否 | 链接列表 |
| `links[].label` | string | 是 | 链接标签 |
| `links[].url` | string | 是 | 链接URL |

---

## 请求示例

### cURL

```bash
curl -X PATCH "http://localhost:3000/api/v1/journeys/04d7126d-219f-49ab-b71a-a595c18d6b8f/tasks/task-id-1" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "completed": true
  }'
```

---

## 响应数据

### 成功响应（200 OK）

```json
{
  "success": true,
  "task": {
    "id": "task-id-1",
    "title": "确认护照有效期及前往冰岛是否需要签证/入境许可",
    "completed": true,
    "category": "preparation",
    "destination": "冰岛",
    "links": [
      {
        "label": "IATA 入境政策查询",
        "url": "https://www.iatatravelcentre.com/"
      }
    ],
    "autoGenerated": true,
    "createdAt": 1735046400000
  },
  "message": "更新成功"
}
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `success` | boolean | 是否成功 |
| `task` | object | 更新后的任务 |
| `task.id` | string | 任务ID |
| `task.title` | string | 任务标题 |
| `task.completed` | boolean | 是否完成 |
| `task.category` | string | 任务类别 |
| `task.destination` | string | 目的地 |
| `task.links` | array | 相关链接列表 |
| `task.autoGenerated` | boolean | 是否自动生成 |
| `task.createdAt` | number | 创建时间（时间戳） |
| `message` | string | 响应消息 |

---

## 错误响应

### 404 Not Found

```json
{
  "statusCode": 404,
  "message": "任务不存在: task-id-1",
  "error": "Not Found"
}
```

### 403 Forbidden

```json
{
  "statusCode": 403,
  "message": "无权修改此行程",
  "error": "Forbidden"
}
```

---

## 使用示例

### JavaScript/TypeScript

```typescript
const journeyId = '04d7126d-219f-49ab-b71a-a595c18d6b8f';
const taskId = 'task-id-1';

// 只更新完成状态
const updateData = {
  completed: true,
};

const response = await fetch(`/api/v1/journeys/${journeyId}/tasks/${taskId}`, {
  method: 'PATCH',
  headers: {
    Authorization: `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(updateData),
});

const result = await response.json();
if (result.success) {
  console.log('更新成功:', result.task);
}
```

---

## 注意事项

1. **部分更新**：所有字段都是可选的，只传入需要更新的字段即可

2. **权限控制**：只能修改当前登录用户自己的行程任务

3. **链接更新**：如果更新 `links`，需要提供完整的链接数组（会替换原有链接）

4. **自动生成任务**：自动生成的任务也可以修改，修改后仍保留 `autoGenerated` 标记


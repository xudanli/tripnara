# 行程接口文档 - 21. 新增自定义任务

## 接口信息

**接口路径：** `POST /api/v1/journeys/{journeyId}/tasks`

**接口描述：** 为行程添加一个自定义任务

**认证：** 需要 JWT Token（Bearer Token）

**Content-Type：** `application/json`

---

## 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `journeyId` | string | 是 | 行程ID（UUID） |

---

## 请求参数

### 请求体结构

```json
{
  "title": "购买旅行保险",
  "category": "preparation",
  "destination": "冰岛",
  "links": [
    {
      "label": "保险购买链接",
      "url": "https://example.com/insurance"
    }
  ]
}
```

### 字段说明

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `title` | string | 是 | 任务标题 |
| `category` | string | 否 | 任务类别（如：preparation） |
| `destination` | string | 否 | 目的地 |
| `links` | array | 否 | 链接列表 |
| `links[].label` | string | 是 | 链接标签 |
| `links[].url` | string | 是 | 链接URL |

---

## 请求示例

### cURL

```bash
curl -X POST "http://localhost:3000/api/v1/journeys/04d7126d-219f-49ab-b71a-a595c18d6b8f/tasks" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "购买旅行保险",
    "category": "preparation",
    "destination": "冰岛",
    "links": [
      {
        "label": "保险购买链接",
        "url": "https://example.com/insurance"
      }
    ]
  }'
```

---

## 响应数据

### 成功响应（200 OK）

```json
{
  "success": true,
  "task": {
    "id": "task-id-new-1",
    "title": "购买旅行保险",
    "completed": false,
    "category": "preparation",
    "destination": "冰岛",
    "links": [
      {
        "label": "保险购买链接",
        "url": "https://example.com/insurance"
      }
    ],
    "autoGenerated": false,
    "createdAt": 1735046400000
  },
  "message": "创建成功"
}
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `success` | boolean | 是否成功 |
| `task` | object | 创建的任务 |
| `task.id` | string | 任务ID（自动生成） |
| `task.title` | string | 任务标题 |
| `task.completed` | boolean | 是否完成（默认为 false） |
| `task.category` | string | 任务类别 |
| `task.destination` | string | 目的地 |
| `task.links` | array | 相关链接列表 |
| `task.autoGenerated` | boolean | 是否自动生成（自定义任务为 false） |
| `task.createdAt` | number | 创建时间（时间戳） |
| `message` | string | 响应消息 |

---

## 错误响应

### 404 Not Found

```json
{
  "statusCode": 404,
  "message": "行程不存在: 04d7126d-219f-49ab-b71a-a595c18d6b8f",
  "error": "Not Found"
}
```

### 403 Forbidden

```json
{
  "statusCode": 403,
  "message": "无权修改此行程",
  "error": "Forbidden"
}
```

### 400 Bad Request

```json
{
  "statusCode": 400,
  "message": [
    "title must be a string",
    "title should not be empty"
  ],
  "error": "Bad Request"
}
```

---

## 使用示例

### JavaScript/TypeScript

```typescript
const journeyId = '04d7126d-219f-49ab-b71a-a595c18d6b8f';

const newTask = {
  title: '购买旅行保险',
  category: 'preparation',
  destination: '冰岛',
  links: [
    {
      label: '保险购买链接',
      url: 'https://example.com/insurance',
    },
  ],
};

const response = await fetch(`/api/v1/journeys/${journeyId}/tasks`, {
  method: 'POST',
  headers: {
    Authorization: `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(newTask),
});

const result = await response.json();
if (result.success) {
  console.log('创建成功:', result.task);
}
```

---

## 注意事项

1. **权限控制**：只能为当前登录用户自己的行程添加任务

2. **自动生成标记**：自定义任务会标记为 `autoGenerated: false`，与 AI 生成的任务区分

3. **任务ID**：系统会自动生成唯一的任务ID

4. **完成状态**：新创建的任务默认 `completed: false`

5. **链接可选**：`links` 字段是可选的，可以不提供


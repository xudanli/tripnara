# 接口完成情况检查清单

## 已完成的接口 ✅

### 1. 行程 CRUD 接口（/api/itinerary）⚠️ 已废弃
> **注意：** 旧版 `/api/itinerary` 接口已删除，请使用新版 `/api/v1/journeys` 接口。

~~- ✅ `POST /api/itinerary` - 创建行程~~
~~- ✅ `GET /api/itinerary` - 获取行程列表（支持分页和状态筛选）~~
~~- ✅ `GET /api/itinerary/:id` - 获取行程详情~~
~~- ✅ `PATCH /api/itinerary/:id` - 更新行程~~
~~- ✅ `DELETE /api/itinerary/:id` - 删除行程~~
~~- ✅ `POST /api/itinerary/generate` - 生成旅行行程~~
~~- ✅ `POST /api/itinerary/from-frontend-data` - 从前端数据格式创建行程~~

### 2. 行程模版接口（/api/v1/itineraries）
- ✅ `POST /api/v1/itineraries` - 新建行程模版
- ✅ `GET /api/v1/itineraries` - 获取行程模版列表（支持多种筛选条件）
- ✅ `GET /api/v1/itineraries/:id` - 获取行程模版详情
- ✅ `PUT /api/v1/itineraries/:id` - 更新行程模版
- ✅ `DELETE /api/v1/itineraries/:id` - 删除行程模版
- ✅ `POST /api/v1/itineraries/:id/publish` - 发布行程模版
- ✅ `POST /api/v1/itineraries/:id/clone` - 复制行程模版

---

## 未完成的接口 ❌

### 1. 行程（Journey）- v1 接口

- ✅ `POST /api/v1/journeys/generate` - 使用 AI 生成旅行行程
- ✅ `GET /api/v1/journeys` - 用户行程列表
- ✅ `POST /api/v1/journeys` - 创建行程（可带 `templateId`、用户偏好、AI 生成参数）
- ✅ `POST /api/v1/journeys/from-frontend-data` - 从前端数据格式创建行程
- ✅ `GET /api/v1/journeys/:journeyId` - 行程详情
- ✅ `PATCH /api/v1/journeys/:journeyId` - 更新行程元信息
- ✅ `PATCH /api/v1/journeys/:journeyId/from-frontend-data` - 从前端数据格式更新行程
- ✅ `DELETE /api/v1/journeys/:journeyId` - 删除行程
- ✅ `POST /api/v1/journeys/:journeyId/clone` - 复制行程
- ✅ `POST /api/v1/journeys/:journeyId/share` - 分享行程
- ✅ `POST /api/v1/journeys/:journeyId/export` - 导出行程（PDF/ICS/JSON）
- ✅ `POST /api/v1/journeys/:journeyId/reset` - 重置为初始状态（保留历史版本）

**细粒度操作接口：**
- ✅ `GET /api/v1/journeys/:journeyId/days` - 获取行程的所有天数
- ✅ `POST /api/v1/journeys/:journeyId/days` - 为行程添加天数
- ✅ `PATCH /api/v1/journeys/:journeyId/days/:dayId` - 更新指定天数
- ✅ `DELETE /api/v1/journeys/:journeyId/days/:dayId` - 删除指定天数
- ✅ `GET /api/v1/journeys/:journeyId/days/:dayId/slots` - 获取指定天数的所有时间段
- ✅ `POST /api/v1/journeys/:journeyId/days/:dayId/slots` - 为指定天数添加时间段
- ✅ `PATCH /api/v1/journeys/:journeyId/days/:dayId/slots/:slotId` - 更新指定时间段
- ✅ `DELETE /api/v1/journeys/:journeyId/days/:dayId/slots/:slotId` - 删除指定时间段
- ✅ `POST /api/v1/journeys/:journeyId/days/:dayId/slots/reorder` - 重新排序时间段

**说明：** 
- 旧版 `/api/itinerary` 接口已删除，现在统一使用 `/api/v1/journeys`（新版 v1 接口）
- `POST /api/v1/journeys/generate` - 使用 AI 生成行程（调用 DeepSeek 模型）

---

### 2. 行程生成与 AI

- ❌ `POST /api/v1/journeys/:journeyId/generate` - 启动完整生成流程
  - body 可指定需要的阶段：`["framework","dayDetails","transport","tips","scenicIntro","safetyNotice"]`
- ❌ `GET /api/v1/journeys/:journeyId/generate/status` - 查看生成进度
- ❌ `POST /api/v1/journeys/:journeyId/generate/framework` - 生成框架
- ❌ `POST /api/v1/journeys/:journeyId/generate/day-details` - 生成天数详情
- ❌ `POST /api/v1/journeys/:journeyId/generate/transport` - 生成交通信息
- ❌ `POST /api/v1/journeys/:journeyId/generate/scenic-intro` - 生成风景介绍
- ❌ `POST /api/v1/journeys/:journeyId/generate/tips` - 生成旅行建议
- ❌ `POST /api/v1/journeys/:journeyId/generate/safety-notice` - 生成安全提示
- ❌ `GET /api/v1/journeys/:journeyId/ai/logs` - 查询 AI 调用日志
- ❌ `GET /api/v1/ai/safety-notice/cache` - 缓存命中情况（仅限后台）
- ❌ `DELETE /api/v1/ai/safety-notice/cache/:key` - 清除缓存项

**说明：** 
- ✅ `POST /api/v1/journeys/generate` - 使用 AI 生成行程（已恢复）
- 其他分阶段生成接口待实现

---

### 3. 准备任务 & Checklist

- ✅ `GET /api/v1/journeys/:journeyId/tasks` - 查看行程准备任务
- ✅ `POST /api/v1/journeys/:journeyId/tasks/sync` - 根据目的地/模板重新生成并合并
- ✅ `PATCH /api/v1/journeys/:journeyId/tasks/:taskId` - 修改任务（完成状态、自定义标题、链接）
- ✅ `DELETE /api/v1/journeys/:journeyId/tasks/:taskId` - 删除任务
- ✅ `POST /api/v1/journeys/:journeyId/tasks` - 新增自定义任务
- ✅ `GET /api/v1/journeys/preparation-profiles` - 获取准备任务模板列表
- ✅ `GET /api/v1/journeys/preparation-profiles/:id` - 获取准备任务模板详情
- ✅ `POST /api/v1/journeys/preparation-profiles` - 创建任务模板（仅管理员）

**说明：** 当前在创建行程模版时支持 `tasks` 字段，但缺少独立的任务管理接口。

---

### 5. 安全提示 & 旅行提醒

- ❌ `POST /api/v1/journeys/:journeyId/safety-notice` - 生成/刷新安全提示（调用 AI + 缓存）
- ❌ `GET /api/v1/journeys/:journeyId/safety-notice` - 当前提示内容
- ❌ `GET /api/v1/alerts` - 通用旅行安全通知（按目的地/时间段）
- ❌ `POST /api/v1/alerts` - 创建安全通知（后台）

---

### 6. 外部数据聚合

部分已实现，但缺少以下接口：

- ❌ `GET /api/v1/destinations/:id/events` - 活动信息（Eventbrite 等）
- ❌ `GET /api/v1/destinations/:id/weather` - 天气信息（可选）
- ❌ `POST /api/v1/transport/insights` - 交通规划（origin/destination/mode）
- ❌ `POST /api/v1/poi/search` - POI 搜索（前端 `ExperienceDay` 复用）

**已实现：**
- ✅ `GET /api/destinations/search` - 地点模糊匹配 + Geo 数据（在 destination.controller.ts 中）
- ✅ `GET /api/destinations/:id/details` - 目的地详情（在 destination.controller.ts 中）

---

### 7. 图片与媒体

- ❌ `POST /api/v1/media/search-image` - 根据地点/关键词获取图片（代理 Unsplash/Pexels）
- ❌ `POST /api/v1/media/search-video` - 搜索视频
- ❌ `POST /api/v1/media/upload` - 用户上传媒体（如支持）
- ❌ `GET /api/v1/media/:mediaId` - 获取媒体元信息/签名 URL

---

### 8. 日志、版本与协作

- ❌ `GET /api/v1/journeys/:journeyId/history` - 版本/操作日志
- ❌ `POST /api/v1/journeys/:journeyId/revert/:versionId` - 回退到指定版本
- ❌ `POST /api/v1/journeys/:journeyId/collaborators` - 添加编辑者
- ❌ `DELETE /api/v1/journeys/:journeyId/collaborators/:userId` - 移除编辑者
- ❌ `GET /api/v1/journeys/:journeyId/notifications` - 获取通知

---

### 9. 用户行为与推荐（可选）

- ❌ `POST /api/v1/journeys/:journeyId/feedback` - 对生成结果打分/评论
- ❌ `GET /api/v1/journeys/recommendations` - 推荐模板或行程
- ❌ `GET /api/v1/analytics/dashboard` - 后台：AI 调用、热门目的地等

---

### 10. 系统管理（Admin）

- ❌ `GET /api/v1/admin/ai/logs` - 筛选 AI 调用
- ❌ `GET /api/v1/admin/templates` - 管理所有模板
- ❌ `GET /api/v1/admin/journeys` - 查看所有行程（运营/客服）
- ❌ `POST /api/v1/admin/preparation-profiles` - 创建任务模板（管理员）
- ❌ `DELETE /api/v1/admin/preparation-profiles/:id` - 删除任务模板（管理员）
- ❌ `GET /api/v1/admin/external-keys` - 查看外部 API 密钥（仅超级管理员）

---

## 总结

### 完成度统计

- **已完成：** 28 个接口（行程 CRUD + 行程模版基础操作 + 行程 v1 基础接口 + 细粒度操作接口）
- **未完成：** 约 65+ 个接口

### 优先级建议

1. **高优先级：**
   - 行程（Journey）- v1 接口（迁移或新增）
   - 准备任务 & Checklist（任务管理功能）
   - 行程生成与 AI - 分阶段生成（提升用户体验）

2. **中优先级：**
   - 模板管理（Template）- 细粒度接口（如果需要细粒度编辑）
   - 安全提示 & 旅行提醒（安全相关功能）
   - 外部数据聚合 - 缺失接口（增强数据丰富度）

3. **低优先级：**
   - 图片与媒体（如果不需要）
   - 日志、版本与协作（如果不需要版本控制）
   - 用户行为与推荐（可选功能）
   - 系统管理（Admin）（后台功能）

---

## 注意事项

1. **接口路径：** 
   - 行程接口：`/api/v1/journeys`（已删除旧版 `/api/itinerary`）
   - 模版接口：`/api/v1/itineraries`（注意：不是 `/api/v1/templates`）
   
   需要确认是否需要：
   - 迁移现有接口到新路径
   - 同时支持新旧路径
   - 或者接口清单需要更新

2. **功能重叠：** 行程模版（`/api/v1/itineraries`）和模板（`/api/v1/templates`）可能是不同的概念，需要确认。

3. **认证要求：** 接口清单中的接口可能需要不同的认证策略（JWT、管理员权限等）。


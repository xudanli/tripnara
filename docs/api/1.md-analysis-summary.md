# æ•°æ®ç»“æ„å­˜å‚¨åˆ†ææ€»ç»“

## é—®é¢˜

æ£€æŸ¥ `docs/api/1.md` ä¸­çš„å‰ç«¯æ•°æ®ç»“æ„æ˜¯å¦å¯ä»¥é€šè¿‡åç«¯æ¥å£å­˜å‚¨ã€‚

---

## âœ… ç­”æ¡ˆï¼š**å¯ä»¥å­˜å‚¨ï¼Œä½†è¯¦ç»†ä¿¡æ¯ä¼šä¸¢å¤±**

---

## ğŸ“‹ æ•°æ®ç»“æ„åˆ†æ

### å‰ç«¯æ•°æ®ç»“æ„ç‰¹ç‚¹

1. **é¡¶å±‚ç»“æ„**ï¼š
   - `backendItineraryId` - åç«¯è¡Œç¨‹IDï¼ˆåˆ›å»ºæ—¶ä¸éœ€è¦ï¼‰
   - `itineraryData` - è¡Œç¨‹æ•°æ®å¯¹è±¡

2. **itineraryData ç»“æ„**ï¼š
   - åŸºç¡€å­—æ®µï¼š`destination`, `duration`, `totalCost`, `summary`, `title`
   - åå¥½å­—æ®µï¼š`budget`, `preferences`ï¼ˆæ•°ç»„ï¼‰, `travelStyle`
   - å¤©æ•°æ•°ç»„ï¼š`days[]`ï¼Œæ¯ä¸ªåŒ…å« `timeSlots[]`
   - å…¶ä»–å­—æ®µï¼š`itinerary`ï¼ˆç©ºæ•°ç»„ï¼‰, `recommendations`ï¼ˆå¯¹è±¡ï¼‰

3. **timeSlots ç‰¹ç‚¹**ï¼š
   - ä½¿ç”¨ `timeSlots` è€Œä¸æ˜¯ `activities`
   - ä½¿ç”¨ `coordinates` è€Œä¸æ˜¯ `location`
   - åŒ…å« `details` å¤æ‚å¯¹è±¡ï¼ˆåŒ…å«è¯¦ç»†ä¿¡æ¯ï¼‰

---

## âœ… å­˜å‚¨æ–¹æ¡ˆ

### æ¨èæ¥å£ï¼š`POST /api/v1/journeys/from-frontend-data`

è¿™ä¸ªæ¥å£ä¸“é—¨è®¾è®¡ç”¨äºæ¥æ”¶å‰ç«¯æ•°æ®æ ¼å¼ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œå­—æ®µæ˜ å°„å’Œè½¬æ¢ã€‚

---

## ğŸ“Š å­—æ®µå­˜å‚¨æƒ…å†µå¯¹æ¯”

### âœ… ä¼šè¢«å­˜å‚¨çš„å­—æ®µ

| å‰ç«¯å­—æ®µ | åç«¯å­˜å‚¨ | çŠ¶æ€ |
|---------|---------|------|
| `itineraryData.destination` | `ItineraryEntity.destination` | âœ… |
| `itineraryData.duration` | `ItineraryEntity.daysCount` | âœ… |
| `itineraryData.totalCost` | `ItineraryEntity.totalCost` | âœ… |
| `itineraryData.summary` | `ItineraryEntity.summary` | âœ… |
| `itineraryData.title` | å¯ç”¨äºç”Ÿæˆæ‘˜è¦ | âœ… |
| `itineraryData.budget` | `ItineraryEntity.preferences.budget` | âœ… |
| `itineraryData.preferences[]` | `ItineraryEntity.preferences.interests` | âœ… |
| `itineraryData.travelStyle` | `ItineraryEntity.preferences.travelStyle` | âœ… |
| `itineraryData.days[].day` | `ItineraryDayEntity.day` | âœ… |
| `itineraryData.days[].date` | `ItineraryDayEntity.date` | âœ… |
| `timeSlot.time` | `ItineraryActivityEntity.time` | âœ… |
| `timeSlot.title` æˆ– `activity` | `ItineraryActivityEntity.title` | âœ… |
| `timeSlot.type` | `ItineraryActivityEntity.type` | âœ… |
| `timeSlot.coordinates` | `ItineraryActivityEntity.location` | âœ… |
| `timeSlot.duration` | `ItineraryActivityEntity.duration` | âœ… |
| `timeSlot.cost` | `ItineraryActivityEntity.cost` | âœ… |
| `timeSlot.notes` | `ItineraryActivityEntity.notes` | âœ… |

### âš ï¸ ä¸ä¼šè¢«å­˜å‚¨çš„å­—æ®µ

| å‰ç«¯å­—æ®µ | åŸå›  | å½±å“ |
|---------|------|------|
| `backendItineraryId` | åˆ›å»ºæ–°è¡Œç¨‹ä¸éœ€è¦ | æ— å½±å“ |
| `itineraryData.itinerary` | ç©ºæ•°ç»„ | æ— å½±å“ |
| `itineraryData.recommendations` | å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒ | **ä¸¢å¤±æ¨èä¿¡æ¯** âš ï¸ |
| `timeSlot.details` | å½“å‰åªå­˜å‚¨åŸºç¡€å­—æ®µ | **è¯¦ç»†ä¿¡æ¯ä¸¢å¤±** âš ï¸ |

---

## ğŸ” Details å­—æ®µè¯¦ç»†åˆ†æ

### å‰ç«¯ details åŒ…å«çš„å­—æ®µ

```json
{
  "details": {
    "name": { "chinese": "...", "english": "...", "local": "..." },
    "address": { "chinese": "...", "english": "...", "local": "..." },
    "transportation": "...",
    "openingHours": "...",
    "pricing": { "detail": "..." },
    "rating": 4.7,
    "recommendations": {
      "visitTips": "...",
      "bestTimeToVisit": "...",
      "nearbyAttractions": "...",
      "visitDuration": 45,
      "outfitSuggestions": "...",
      "culturalTips": "...",
      "bookingInfo": "..."
    },
    "contact": { "info": "..." },
    "accessibility": "...",
    "category": "..."
  }
}
```

### å½“å‰å­˜å‚¨æƒ…å†µ

- âœ… `details` ä¸­çš„åŸºæœ¬ä¿¡æ¯å·²é€šè¿‡åŸºç¡€å­—æ®µä¿å­˜ï¼ˆtitle, notesï¼‰
- âŒ `details` ä¸­çš„è¯¦ç»†ç»“æ„åŒ–ä¿¡æ¯**ä¸ä¼šè¢«å­˜å‚¨**
- âŒ å¤šè¯­è¨€åç§°ã€åœ°å€ç­‰ä¿¡æ¯**ä¸ä¼šè¢«å­˜å‚¨**
- âŒ æ¨èä¿¡æ¯ã€æ–‡åŒ–æç¤ºç­‰**ä¸ä¼šè¢«å­˜å‚¨**

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å‘é€è¯·æ±‚

```typescript
// å»æ‰ backendItineraryIdï¼Œç›´æ¥å‘é€
const response = await fetch('/api/v1/journeys/from-frontend-data', {
  method: 'POST',
  headers: {
    Authorization: `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    itineraryData: {
      destination: "å†°å²›",
      duration: 5,
      budget: "medium",
      preferences: ["nature", "adventure"],
      travelStyle: "moderate",
      days: [
        {
          day: 1,
          date: "2025-11-24",
          timeSlots: [
            {
              time: "09:00",
              title: "æ¢ç§˜é›·å…‹é›…æœªå…‹å¤§æ•™å ‚çš„èºæ—‹å¤©é™…",
              activity: "æ¢ç§˜é›·å…‹é›…æœªå…‹å¤§æ•™å ‚çš„èºæ—‹å¤©é™…",
              type: "attraction",
              coordinates: { lat: 64.1419, lng: -21.9274 },
              notes: "ç™»ä¸Šå“ˆå°”æ ¼æ—å§†æ•™å ‚å¡”é¡¶...",
              cost: 1200,
              duration: 90
              // details å­—æ®µä¼šè¢«å¿½ç•¥
            }
          ]
        }
      ],
      totalCost: 88400,
      summary: "5å¤©çš„å†°å²›ä¹‹æ—…...",
      title: "å†°å²›ä¹‹æ—…"
    }
  }),
});
```

---

## âš ï¸ é‡è¦æç¤º

### 1. Details ä¿¡æ¯ä¸¢å¤±

å¦‚æœå‰ç«¯éœ€è¦ä¿ç•™ `details` ä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼Œå½“å‰ç‰ˆæœ¬**æ— æ³•è‡ªåŠ¨å­˜å‚¨**ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **æ–¹æ¡ˆAï¼ˆæ¨èï¼‰**ï¼šæ‰©å±• `ItineraryActivityEntity`ï¼Œæ·»åŠ  `details` JSONB å­—æ®µ
- **æ–¹æ¡ˆB**ï¼šå°† `details` åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œå­˜å‚¨åˆ° `notes` å­—æ®µï¼ˆä¼šæ··åˆåœ¨å¤‡æ³¨ä¸­ï¼Œä¸æ¨èï¼‰
- **æ–¹æ¡ˆC**ï¼šä½¿ç”¨å•ç‹¬çš„è¯¦ç»†ä¿¡æ¯å­˜å‚¨è¡¨

### 2. Recommendations ä¿¡æ¯ä¸¢å¤±

`itineraryData.recommendations` å¯¹è±¡ä¸ä¼šè¢«å­˜å‚¨ï¼Œå¦‚æœéœ€è¦ä¿å­˜ï¼š
- **æ–¹æ¡ˆA**ï¼šæ‰©å±• `ItineraryEntity.preferences`ï¼Œæ·»åŠ  `recommendations` å­—æ®µ
- **æ–¹æ¡ˆB**ï¼šä½¿ç”¨å•ç‹¬çš„æ¨èä¿¡æ¯è¡¨

---

## âœ… æœ€ç»ˆç»“è®º

### âœ… **åŸºç¡€æ•°æ®å¯ä»¥å­˜å‚¨**

ä½¿ç”¨ `POST /api/v1/journeys/from-frontend-data` æ¥å£ï¼Œä»¥ä¸‹æ•°æ®ä¼šè¢«å®Œæ•´å­˜å‚¨ï¼š

- âœ… è¡Œç¨‹åŸºæœ¬ä¿¡æ¯ï¼ˆç›®çš„åœ°ã€å¤©æ•°ã€æ€»è´¹ç”¨ã€æ‘˜è¦ï¼‰
- âœ… ç”¨æˆ·åå¥½ï¼ˆé¢„ç®—ã€å…´è¶£ã€æ—…è¡Œé£æ ¼ï¼‰
- âœ… å¤©æ•°ä¿¡æ¯ï¼ˆå¤©æ•°åºå·ã€æ—¥æœŸï¼‰
- âœ… æ´»åŠ¨åŸºç¡€ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ ‡é¢˜ã€ç±»å‹ã€ä½ç½®ã€æ—¶é•¿ã€è´¹ç”¨ã€å¤‡æ³¨ï¼‰

### âš ï¸ **è¯¦ç»†ä¿¡æ¯æ— æ³•å­˜å‚¨**

ä»¥ä¸‹æ•°æ®å½“å‰ä¸ä¼šè¢«ä¿å­˜ï¼š

- âŒ `timeSlot.details` å¯¹è±¡ï¼ˆåŒ…å«è¯¦ç»†ä¿¡æ¯ï¼‰
- âŒ `itineraryData.recommendations` å¯¹è±¡

---

## ğŸ”§ å»ºè®®

1. **å¦‚æœåªéœ€è¦åŸºç¡€æ•°æ®**ï¼šç›´æ¥ä½¿ç”¨ `from-frontend-data` æ¥å£å³å¯
2. **å¦‚æœéœ€è¦ä¿å­˜è¯¦ç»†ä¿¡æ¯**ï¼šéœ€è¦æ‰©å±•æ•°æ®åº“å®ä½“å’Œæ¥å£ï¼Œæ·»åŠ  `details` å­—æ®µæ”¯æŒ

